/* Router Class */
var fs = require('fs');

module.exports = function(App, Server) {
	var Router = {};

	Router.route = function(opts) {
		var parts = parseForStringReturnSplit(opts.handler);
		//if this routes handler is going to a controller method
		//@todo add better doc of controller parts
		if(parts) {
			Server.route({
				method:opts.method,
				path:opts.path,
				handler:function(request, reply) {
					var controllerName = parts[0];
					var controllerMethod = parts[1];

					var controller = App.Loader.controllers.build(controllerName, App.Loader.dependencies);
					controller[controllerMethod](request, reply);
				}
			});

		}else{
			Server.route(opts);
		}
	}

	Router.loadRoute = function(link) {
		var route = require(link)(App, Router);
	}

	Router.loadRouteFiles = function(dir, cb) {
		var routeFiles = fs.readdir(dir, function(err, files) {
			files.forEach(function(file) {
				Router.loadRoute('.' + dir + file);
			});
		});
	}

	return Router;
}

function parseForStringReturnSplit(path) {
	if(typeof path === 'string') {
		var pathParts = path.split('@');

		return pathParts;
	}

	return false;
}
